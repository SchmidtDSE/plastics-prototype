Standalone Engine
================================================================================
This short document describes stand-alone execution of the plastics interventions simulation outside the browser along with description of data artifacts potentially useful to other developers.

<br>

Purpose
--------------------------------------------------------------------------------
The [Global Plastics Tool](https://global-plastics-tool.org/) leverages a custom policy evaluation engine to simulate how complex intersecting policy scenarios may influence outcomes for both global and regional plastic waste, consumption, and trade. Notably, the simulation engine determines how different policies interact so the system is required to "stack" interventions on top of each other. For example, the policy effects of a minimum recycling rate and minimum recycled content cannot simply be determined independently and added to each other to calculate the overall outcome as the two interventions simultaneously manipulate the same variables.

All this in mind, this project provides the implementation of this engine in Javascript to allow for execution of the model and intervention simulations both inside and outside the browser. Furthermore, as part of its CI / CD process, JSON files are generated using the stand-alone execution option which describe model predictions for commonly used scenarios. This short technical document describes how to use the stand alone-engine and details how to use data artifacts generated by the stand-alone engine during CI / CD.

While this option is provided, note that in-browser execution remains the recommended / preferred way to interact with the policy engine. See [project root](https://github.com/SchmidtDSE/plastics-prototype) for details on how to use the UI / browser-based tool.

<br>

Usage
--------------------------------------------------------------------------------
The stand-alone engine may be used either interactively through Node or through JSON files generated during CI / CD. This section covers the use of pre-generated files. Specifically, common scenarios are pre-calculated during the CI / CD process and available for use with a simple HTTP GET. The following files are available for individual policy scenarios:

 - [banPsPackaging.json](https://global-plastics-tool.org/standalone_tasks/banPsPackaging.json): The result of having banned polystyrene packaging.
 - [banSingleUse.json](https://global-plastics-tool.org/standalone_tasks/banSingleUse.json): The result of having reduced single use packaging by 90%.
 - [capVirgin.json](https://global-plastics-tool.org/standalone_tasks/capVirgin.json): The result of having capped virgin plastic production to 2030 business as ususal levels.
 - [minimumRecycledContent.json](https://global-plastics-tool.org/standalone_tasks/minimumRecycledContent.json): The result of a 40% minimum recycled content mandate for new products.
 - [minimumRecyclingRate.json](https://global-plastics-tool.org/standalone_tasks/minimumRecyclingRate.json): The result of a 40% minimum recycling collectino rate mandate.
 - [recyclingInvestment.json](https://global-plastics-tool.org/standalone_tasks/recyclingInvestment.json): The result of 100B investment in recycling collection and infrastructure.
 - [reducedAdditives.json](https://global-plastics-tool.org/standalone_tasks/reducedAdditives.json): The result of 90% reduction in additives.
 - [taxVirigin.json](https://global-plastics-tool.org/standalone_tasks/taxVirigin.json): The result of a high consumption tax (see tool for more details).
 - [wasteInvestment.json](https://global-plastics-tool.org/standalone_tasks/wasteInvestment.json): The result of 100B investment in non-recycling waste management including incineration and landfill.

Furthermore, the following describe complex multi-intervention scenarios:

 - [all.json](https://global-plastics-tool.org/standalone_tasks/all.json): The result of all 9 policy scenarios checked turned up to the highest allowed levels.
 - [highAmbition.json](https://global-plastics-tool.org/standalone_tasks/highAmbition.json): The result of a cap and tax scheme which represents the combination of 2030 virgin production cap, 40% minimum recycled content, 100B investment in recycling, and 100B investment in other waste infrastructure, and a high consumption tax.
 - [lowAmbition.json](https://global-plastics-tool.org/standalone_tasks/lowAmbition.json): The result of "commonly discussed interventions" that includes ban of polystyrene packaging, 90% reduction in single use plastics, 90% reduced additives, and 40% minimum recycling rate.

<br>

Local environment
--------------------------------------------------------------------------------
Custom policy scenarios may not be covered by pre-built files. Therefore, to use the Node-based stand-alone engine, developers must first build the project in a local environment. Specifically, this tool uses a domain specific language written in [ANTLR](https://www.antlr.org/) that requires a pre-build step before usage. To begin, install prerequisites:

 - Install [Node.js](https://nodejs.org/en)
 - Install [Java](https://adoptium.net/)

Note that Python is also used for some automation:

 - Install [Python](https://docs.python-guide.org/starting/installation/)
 - Install Python dependencies: `pip install -r requirements.txt`.

Next, build the project:

 - Clone the repository (`git clone git@github.com:SchmidtDSE/plastics-prototype.git`)
 - Setup the project for local execution (`bash support/setup_local.sh`). This will also perform code generation steps (see `support/make.sh`).
 - Install prerequisites for the stand alone engine (`cd js_standalone; npm install`).

Having prepared the project, developers can describe scenarios to the stand alone engine using small JSON files. See `js_standalone/example.json`. Having constructed a task, consider the following example to execute a simulation:

```
cd js_standalone
npm run standalone ./example.json ./test_output.json
```

Note that `example.json` here refers to the task JSON file and `test_output.json` is where the results of the simulation will be written.

<br>

Deployment
--------------------------------------------------------------------------------
The deployment step includes generation of outputs during CI / CD. The scenarios considered in that step can be modified by editing `support/build_scenarios.py`.

<br>

Development standards
--------------------------------------------------------------------------------
CI / CD tests output generation though `support/check_standalone.sh` and changes to `support/build_scenarios.py` should be reflected in that file. Furthermore, all pull requests should pass linting executed by CI / CD. This check can also be run locally with `npx eslint ./js_standalone/engine/*.js`.

<br>

Open source
--------------------------------------------------------------------------------
Please see central listing of open source libraries used in the [project root](https://github.com/SchmidtDSE/plastics-prototype).

<br>

Updates
--------------------------------------------------------------------------------
The model and interventions may continue to be updated. The JSON files produced by CI / CD are also automatically refreshed in the event of changes to data, model, or intervention code.